// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Job {
  id          String   @id @default(uuid())
  status      String   // RECEIVED, EXTRACTING, NEEDS_REVIEW, READY, ISSUING, ISSUED, FAILED
  owner       String   // "User" for MVP
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Documents
  storagePath String?
  fileType    String?
  
  // Extracted Data
  extractedJson String? // Stored as JSON string
  
  // Emission Results
  facturamaId  String?
  uuid         String?
}

model Tractocamion {
  id                    String   @id @default(uuid())
  customId              String   @unique // R-147, R-148, etc.
  
  // Vehicle details
  marca                 String   // Scania, Kenworth, etc.
  subMarca              String?  // R500, R450, etc.
  modelo                String   // 2023, 2022, etc.
  placa                 String   @unique
  
  // Technical specs
  kilometrajeInicial    Float?
  pesoBrutoVehicular    Float    // kg
  color                 String?
  vin                   String?  // Vehicle Identification Number
  ejesTraseros          Int?
  
  // Configuration
  configuracionVehicular String? // SAT catalog code
  subtipoRemolque       String?  // SAT catalog code
  
  // Insurance
  aseguradora           String?
  numeroPoliza          String?
  vigenciaPoliza        DateTime?
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  userId                String   @default("user_default")
}

model Plataforma {
  id                    String   @id @default(uuid())
  customId              String   @unique // P-001, P-002, etc.
  
  // Vehicle details
  marca                 String   // Fruehauf, etc.
  subMarca              String?
  modelo                String
  placa                 String   @unique
  
  // Technical specs
  pesoBrutoVehicular    Float    // kg
  color                 String?
  vin                   String?
  ejesTraseros          Int?
  
  // Configuration
  configuracionVehicular String? // SAT catalog code
  subtipoRemolque       String?  // SAT catalog code
  
  // Insurance
  aseguradora           String?
  numeroPoliza          String?
  vigenciaPoliza        DateTime?
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  userId                String   @default("user_default")
}

model Dolly {
  id                    String   @id @default(uuid())
  customId              String   @unique // D-001, D-002, etc.
  
  // Vehicle details
  marca                 String   // Hyundai, etc.
  subMarca              String?
  modelo                String
  
  // Technical specs
  pesoBrutoVehicular    Float    // kg
  color                 String?
  vin                   String?
  ejes                  Int?
  
  // Configuration
  configuracionVehicular String? // SAT catalog code
  subtipoRemolque       String?  // SAT catalog code
  
  // Insurance
  aseguradora           String?
  numeroPoliza          String?
  vigenciaPoliza        DateTime?
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  userId                String   @default("user_default")
}

model Operador {
  id              String   @id @default(uuid())
  customId        String   @unique // Autogenerated: OP-001
  
  // Personal info
  nombre          String
  apellidoPaterno String
  apellidoMaterno String?
  
  // Carta Porte requirements (Optional for now as per request "solo es nombre...")
  rfc             String?
  licencia        String?
  
  // Contact
  telefono        String?
  email           String?
  
  // Status
  activo          Boolean  @default(true)
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  userId          String   @default("user_default")
}

model Emisor {
  id              String   @id @default(uuid())
  
  // Fiscal info (required for CFDI 4.0)
  rfc             String   @unique
  nombre          String   // Razón Social
  regimenFiscal   String   // SAT c_RegimenFiscal code (e.g., "601")
  codigoPostal    String   // CP de Expedición
  
  // Optional additional info
  calle           String?
  numeroExterior  String?
  numeroInterior  String?
  colonia         String?
  municipio       String?
  estado          String?
  pais            String   @default("MEX")
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  userId          String   @default("user_default")
}

model RegimenFiscal {
  id          String   @id @default(uuid())
  clave       String   @unique  // SAT code: 601, 603, etc.
  descripcion String             // Full description
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SubtipoRemolque {
  id          String   @id @default(uuid())
  clave       String   @unique  // SAT code: CTR001, CTR002, etc.
  descripcion String             // Full description
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ClaveUnidadPeso {
  id          String   @id @default(uuid())
  clave       String   @unique  // SAT code: KGM, TNE, LTR, etc.
  nombre      String             // Short name
  descripcion String?            // Full description (optional)
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
